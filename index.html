<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Toolbox | –ï–ª–µ–∫—Ç—Ä–æ–Ω—Å–∫–∏ –î–Ω–µ–≤–Ω–∏–∫</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß∞</text></svg>">
  <style>
    /* --- DESIGN SYSTEM --- */
    :root {
      --bg: #f5f7fa;
      --surface: #ffffff;
      --surface-light: #f0f2f5;
      --text: #1a1a2e;
      --text-secondary: #64748b;
      --border: rgba(0, 0, 0, 0.08);
      --accent: #6366f1;
      --accent-hover: #4f46e5;
      --accent-light: rgba(99, 102, 241, 0.1);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
      --radius: 12px;
      --radius-sm: 8px;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --surface: #1e293b;
      --surface-light: #334155;
      --text: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: rgba(255, 255, 255, 0.08);
      --accent: #818cf8;
      --accent-hover: #6366f1;
      --accent-light: rgba(129, 140, 248, 0.15);
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      transition: background 0.3s, color 0.3s;
    }

    /* --- TOP NAVIGATION --- */
    .top-nav {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 8px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-sm);
      flex-wrap: wrap;
    }

    .nav-btn {
      width: 38px;
      height: 38px;
      border: 1px solid var(--border);
      background: var(--surface-light);
      color: var(--text);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: all 0.2s;
    }

    .nav-btn:hover { 
      background: var(--accent); 
      color: white; 
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .nav-btn.danger:hover {
      background: var(--danger);
      border-color: var(--danger);
    }

    .nav-btn.success:hover {
      background: var(--success);
      border-color: var(--success);
    }

    .nav-separator { 
      width: 1px; 
      height: 24px; 
      background: var(--border); 
      margin: 0 8px; 
    }

    .nav-stats {
      margin-left: auto;
      display: flex;
      gap: 16px;
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .nav-stats span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .lang-toggle {
      background: var(--accent-light);
      color: var(--accent);
      border: 1px solid var(--accent);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .lang-toggle:hover {
      background: var(--accent);
      color: white;
    }

    /* --- HEADER --- */
    .header {
      text-align: center;
      padding: 50px 20px 30px;
      background: linear-gradient(135deg, var(--accent-light) 0%, transparent 100%);
    }

    .header-logo { 
      font-size: 60px; 
      margin-bottom: 12px; 
      filter: drop-shadow(0 4px 8px rgba(99, 102, 241, 0.3));
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    .header-title {
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 1px;
      color: var(--text);
      margin-bottom: 8px;
    }

    .header-subtitle {
      color: var(--accent);
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* --- SEARCH & FILTERS --- */
    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px;
      margin-bottom: 10px;
    }

    .search-wrapper {
      position: relative;
      width: 100%;
      max-width: 400px;
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 16px;
    }

    .search-input {
      width: 100%;
      padding: 14px 20px 14px 44px;
      border: 2px solid var(--border);
      border-radius: 30px;
      font-size: 15px;
      background: var(--surface);
      color: var(--text);
      outline: none;
      transition: all 0.3s;
    }

    .search-input:focus { 
      border-color: var(--accent); 
      box-shadow: 0 0 0 4px var(--accent-light); 
    }

    .search-input::placeholder { color: var(--text-secondary); }

    .filter-tabs {
      display: flex;
      background: var(--surface);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .filter-tab {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 12px 24px;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      border-right: 1px solid var(--border);
    }

    .filter-tab:last-child { border-right: none; }
    .filter-tab:hover { background: var(--surface-light); color: var(--text); }
    .filter-tab.active { background: var(--accent); color: white; }

    /* --- MAIN CONTENT --- */
    .main { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 0 20px 120px; 
    }

    .category-section {
      margin-bottom: 30px;
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
    }

    .category-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .category-count {
      background: var(--accent-light);
      color: var(--accent);
      padding: 2px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }

    .app-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 16px;
    }

    @media (max-width: 1200px) {
      .app-grid { grid-template-columns: repeat(4, 1fr); }
    }
    
    @media (max-width: 900px) {
      .app-grid { grid-template-columns: repeat(3, 1fr); }
    }
    
    @media (max-width: 600px) {
      .app-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .app-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--text);
      position: relative;
      transition: all 0.25s;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .app-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent);
      transition: width 0.2s;
    }

    .app-card[data-priority="1"]::before { background: var(--success); }
    .app-card[data-priority="2"]::before { background: var(--warning); }
    .app-card[data-priority="3"]::before { background: var(--danger); }

    .app-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent);
    }

    .app-card:hover::before { width: 6px; }

    .app-icon {
      width: 42px;
      height: 42px;
      background: var(--accent-light);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .app-info { flex: 1; min-width: 0; }

    .app-name { 
      font-weight: 600; 
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* --- Card Actions --- */
    .star-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none; 
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
      transition: all 0.2s;
      opacity: 0.6;
    }

    .star-btn:hover { transform: scale(1.2); opacity: 1; }
    .star-btn.active { color: #f59e0b; opacity: 1; }

    .card-actions {
      position: absolute;
      bottom: 8px;
      right: 8px;
      display: flex;
      gap: 6px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .app-card:hover .card-actions { opacity: 1; }

    .action-btn {
      background: var(--surface-light);
      border: 1px solid var(--border);
      color: var(--text);
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .action-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }
    .action-btn.delete:hover { background: var(--danger); border-color: var(--danger); }

    /* --- Add Card --- */
    .add-card {
      background: var(--surface);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
      color: var(--text-secondary);
      font-weight: 600;
      transition: all 0.2s;
    }

    .add-card:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-light);
    }

    /* --- BOTTOM BAR --- */
    .bottom-bar {
      background: var(--surface);
      border-top: 2px solid var(--accent);
      padding: 14px 20px;
      position: fixed;
      bottom: 0; 
      left: 0; 
      right: 0;
      z-index: 90;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    }

    .bottom-grid {
      display: flex;
      gap: 10px;
      max-width: 1200px;
      margin: 0 auto;
      overflow-x: auto;
      padding-bottom: 4px;
    }

    .bottom-grid::-webkit-scrollbar { height: 4px; }
    .bottom-grid::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }

    .bottom-card {
      background: var(--accent-light);
      padding: 10px 16px;
      border-radius: var(--radius-sm);
      color: var(--accent);
      text-decoration: none;
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .bottom-card:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
    }

    /* --- MODALS --- */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.show { display: flex; }

    .modal {
      background: var(--surface);
      width: 100%;
      max-width: 500px;
      border-radius: var(--radius);
      padding: 28px;
      box-shadow: var(--shadow-lg);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-close {
      background: var(--surface-light);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .modal-close:hover { background: var(--danger); color: white; }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 12px 14px;
      background: var(--bg);
      border: 2px solid var(--border);
      color: var(--text);
      border-radius: var(--radius-sm);
      font-size: 14px;
      transition: all 0.2s;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-light);
    }

    .form-select { cursor: pointer; }

    .icon-picker {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      background: var(--bg);
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 2px solid var(--border);
    }

    .icon-option {
      width: 100%;
      aspect-ratio: 1;
      border: 2px solid transparent;
      background: var(--surface);
      border-radius: 8px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .icon-option:hover { border-color: var(--accent); transform: scale(1.1); }
    .icon-option.active { border-color: var(--accent); background: var(--accent-light); }

    .btn {
      padding: 14px 24px;
      border-radius: var(--radius-sm);
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary { 
      background: var(--accent); 
      color: white; 
      width: 100%; 
    }

    .btn-primary:hover { 
      background: var(--accent-hover); 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      width: 100%;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--surface-light);
      color: var(--text-secondary);
      width: 100%;
      margin-top: 10px;
    }

    .btn-secondary:hover { color: var(--text); }

    /* --- CLEAN EXIT MODAL --- */
    .storage-list {
      max-height: 300px;
      overflow-y: auto;
      margin: 16px 0;
    }

    .storage-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      border: 1px solid var(--border);
    }

    .storage-item:hover {
      border-color: var(--accent);
    }

    .storage-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: var(--accent);
    }

    .storage-info {
      flex: 1;
    }

    .storage-key {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 2px;
    }

    .storage-size {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .storage-total {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      background: var(--accent-light);
      border-radius: var(--radius-sm);
      font-weight: 600;
      margin-bottom: 16px;
    }

    .select-all-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--surface-light);
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
      cursor: pointer;
    }

    .select-all-row:hover {
      background: var(--accent-light);
    }

    .warning-text {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--danger);
      border-radius: var(--radius-sm);
      padding: 12px;
      font-size: 13px;
      color: var(--danger);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* --- IMPORT MODAL --- */
    .import-options {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .file-drop {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--bg);
    }

    .file-drop:hover, .file-drop.dragover {
      border-color: var(--accent);
      background: var(--accent-light);
    }

    .file-drop-icon { font-size: 40px; margin-bottom: 10px; }
    .file-drop-text { color: var(--text-secondary); font-size: 14px; }
    .file-drop-text strong { color: var(--accent); }

    .file-input { display: none; }

    .divider {
      display: flex;
      align-items: center;
      gap: 16px;
      color: var(--text-secondary);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .import-textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      background: var(--bg);
      border: 2px solid var(--border);
      color: var(--text);
      border-radius: var(--radius-sm);
      font-family: 'Consolas', monospace;
      font-size: 12px;
      resize: vertical;
    }

    .import-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .file-selected {
      background: var(--success);
      color: white;
      padding: 10px 16px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    /* --- TOAST --- */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--surface);
      color: var(--text);
      padding: 14px 24px;
      border-radius: 30px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      z-index: 9999;
      opacity: 0;
      transition: all 0.3s;
      border: 2px solid var(--accent);
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .toast.success { border-color: var(--success); }
    .toast.error { border-color: var(--danger); }

    /* --- EMPTY STATE --- */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state-icon { font-size: 60px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state-text { font-size: 16px; }

    /* --- RESPONSIVE --- */
    @media (max-width: 600px) {
      .header-title { font-size: 24px; }
      .nav-stats { display: none; }
      .filter-tab { padding: 10px 14px; font-size: 11px; }
      .app-card { padding: 12px; gap: 10px; }
      .app-icon { width: 36px; height: 36px; font-size: 18px; }
      .app-name { font-size: 13px; }
    }
  </style>
</head>
<body>

  <!-- TOP NAVIGATION -->
  <nav class="top-nav">
    <button class="nav-btn" onclick="resetView()" title="–ü–æ—á–µ—Ç–Ω–∞">üè†</button>
    <div class="nav-separator"></div>
    <button class="nav-btn" id="themeBtn" title="–¢–µ–º–∞">üåô</button>
    <button class="nav-btn" onclick="openImportModal()" title="–£–≤–µ–∑–∏">üì•</button>
    <button class="nav-btn" onclick="exportData()" title="–ò–∑–≤–µ–∑–∏">üì§</button>
    <div class="nav-separator"></div>
    <button class="nav-btn success" onclick="scanGitHub()" title="üîÑ Sync GitHub">üîÑ</button>
    <button class="nav-btn danger" onclick="openCleanExitModal()" title="–ß–∏—Å—Ç –∏–∑–ª–µ–∑">üö™</button>
    <div class="nav-separator"></div>
    <button class="lang-toggle" id="langBtn" onclick="toggleLang()">EN</button>
    
    <div class="nav-stats">
      <span>üì± <strong id="totalApps">0</strong></span>
      <span>‚≠ê <strong id="totalFavs">0</strong></span>
      <span>üîó <strong id="totalGithub">0</strong></span>
    </div>
  </nav>



  <!-- HEADER -->
  <header class="header">
    <div class="header-logo">üß∞</div>
    <h1 class="header-title" data-i18n="title">App Toolbox</h1>
    <p class="header-subtitle" data-i18n="subtitle">–ï–ª–µ–∫—Ç—Ä–æ–Ω—Å–∫–∏ —Å–∏—Å—Ç–µ–º –∑–∞ —Ä–µ—Å—É—Ä—Å–∏</p>
  </header>

  <!-- SEARCH & FILTERS -->
  <div class="controls">
    <div class="search-wrapper">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞...">
    </div>
    <div class="filter-tabs">
      <button class="filter-tab active" data-filter="all" data-i18n="filterAll">–°–∏—Ç–µ</button>
      <button class="filter-tab" data-filter="favorites" data-i18n="filterFavorites">‚≠ê –û–º–∏–ª–µ–Ω–∏</button>
      <button class="filter-tab" data-filter="recent" data-i18n="filterRecent">üïê –ü–æ—Å–ª–µ–¥–Ω–∏</button>
      <button class="filter-tab" data-filter="github" data-i18n="filterGithub">üîó GitHub</button>
      <button class="filter-tab" data-filter="manual" data-i18n="filterManual">‚úèÔ∏è –†–∞—á–Ω–∏</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="main" id="main"></main>

  <!-- BOTTOM BAR -->
  <div class="bottom-bar" id="bottomBar">
    <div class="bottom-grid" id="bottomGrid"></div>
  </div>

  <!-- APP MODAL -->
  <div class="modal-overlay" id="appModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">‚ûï <span data-i18n="addApp">–î–æ–¥–∞—ò –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞</span></h2>
        <button class="modal-close" onclick="closeAppModal()">‚úï</button>
      </div>
      
      <div class="form-group">
        <label class="form-label" data-i18n="labelName">–ò–º–µ</label>
        <input type="text" class="form-input" id="appName" placeholder="–í–Ω–µ—Å–∏ –∏–º–µ...">
      </div>
      
      <div class="form-group">
        <label class="form-label" data-i18n="labelUrl">URL –õ–∏–Ω–∫</label>
        <input type="text" class="form-input" id="appUrl" placeholder="https://...">
      </div>
      
      <div class="form-group">
        <label class="form-label" data-i18n="labelCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞</label>
        <input type="text" class="form-input" id="appCategory" list="categories" placeholder="–ò–∑–±–µ—Ä–∏ –∏–ª–∏ –≤–Ω–µ—Å–∏...">
        <datalist id="categories"></datalist>
      </div>
      
      <div class="form-group">
        <label class="form-label" data-i18n="labelPriority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç / –°—Ç–∞—Ç—É—Å</label>
        <select class="form-select" id="appPriority">
          <option value="0">–°—Ç–∞–Ω–¥–∞—Ä–¥–Ω–æ (–í–∏–æ–ª–µ—Ç–æ–≤–∞)</option>
          <option value="1">–ó–∞–≤—Ä—à–µ–Ω–æ (–ó–µ–ª–µ–Ω–∞)</option>
          <option value="2">–í–∞–∂–Ω–æ (–ü–æ—Ä—Ç–æ–∫–∞–ª–æ–≤–∞)</option>
          <option value="3">–ò—Ç–Ω–æ (–¶—Ä–≤–µ–Ω–∞)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label" data-i18n="labelIcon">–ò–∫–æ–Ω–∞</label>
        <div class="icon-picker" id="iconPicker"></div>
      </div>
      
      <button class="btn btn-primary" onclick="saveApp()">
        üíæ <span data-i18n="btnSave">–ó–∞—á—É–≤–∞—ò</span>
      </button>
      <button class="btn btn-secondary" onclick="closeAppModal()">–û—Ç–∫–∞–∂–∏</button>
    </div>
  </div>

  <!-- IMPORT MODAL -->
  <div class="modal-overlay" id="importModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">üì• <span data-i18n="importTitle">–£–≤–µ–∑–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏</span></h2>
        <button class="modal-close" onclick="closeImportModal()">‚úï</button>
      </div>
      
      <div class="import-options">
        <div class="file-drop" id="fileDrop" onclick="document.getElementById('fileInput').click()">
          <div class="file-drop-icon">üìÅ</div>
          <div class="file-drop-text">
            –í–ª–µ—á–∏ –∏ –ø—É—à—Ç–∏ JSON –¥–∞—Ç–æ—Ç–µ–∫–∞<br>–∏–ª–∏ <strong>–∫–ª–∏–∫–Ω–∏ –∑–∞ –∏–∑–±–æ—Ä</strong>
          </div>
        </div>
        <input type="file" class="file-input" id="fileInput" accept=".json" onchange="handleFileSelect(event)">
        <div id="fileInfo"></div>
        
        <div class="divider">–∏–ª–∏ –∑–∞–ª–µ–ø–∏</div>
        
        <textarea class="import-textarea" id="importData" placeholder='{"apps": [...], "theme": "dark"}...'></textarea>
      </div>
      
      <button class="btn btn-primary" onclick="doImport()" style="margin-top: 20px">
        üöÄ <span data-i18n="btnImport">–ü–æ—á–Ω–∏ —É–≤–æ–∑</span>
      </button>
      <button class="btn btn-secondary" onclick="closeImportModal()">–û—Ç–∫–∞–∂–∏</button>
    </div>
  </div>

  <!-- CLEAN EXIT MODAL -->
  <div class="modal-overlay" id="cleanExitModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">üö™ <span data-i18n="cleanExitTitle">–ß–∏—Å—Ç –∏–∑–ª–µ–∑</span></h2>
        <button class="modal-close" onclick="closeCleanExitModal()">‚úï</button>
      </div>
      
      <div class="warning-text">
        ‚ö†Ô∏è <span data-i18n="cleanExitWarning">–û–≤–∞ —ú–µ –≥–∏ –∏–∑–±—Ä–∏—à–µ –∏–∑–±—Ä–∞–Ω–∏—Ç–µ –ø–æ–¥–∞—Ç–æ—Ü–∏ –æ–¥ –æ–≤–æ—ò —É—Ä–µ–¥. –û–≤–∞–∞ –∞–∫—Ü–∏—ò–∞ –µ –Ω–µ–ø–æ–≤—Ä–∞—Ç–Ω–∞!</span>
      </div>
      
      <div class="storage-total">
        <span data-i18n="totalStorage">–í–∫—É–ø–Ω–æ localStorage:</span>
        <span id="totalStorageSize">0 KB</span>
      </div>
      
      <div class="select-all-row" onclick="toggleSelectAll()">
        <input type="checkbox" class="storage-checkbox" id="selectAllCheckbox">
        <label style="cursor: pointer; font-weight: 600;" data-i18n="selectAll">–ò–∑–±–µ—Ä–∏ —Å–∏—Ç–µ</label>
      </div>
      
      <div class="storage-list" id="storageList"></div>
      
      <button class="btn btn-danger" onclick="performCleanExit()" id="cleanExitBtn">
        üóëÔ∏è <span data-i18n="btnCleanExit">–ò–∑–±—Ä–∏—à–∏ –∏–∑–±—Ä–∞–Ω–æ –∏ –∏–∑–ª–µ–∑–∏</span>
      </button>
      <button class="btn btn-secondary" onclick="closeCleanExitModal()">–û—Ç–∫–∞–∂–∏</button>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script>
    /* ===== CONSTANTS ===== */
    const ICONS = ['üìã', 'üìä', 'üìà', 'üìÖ', 'üìù', 'üìÅ', 'üîß', '‚öôÔ∏è', 'üé®', 'üì±', 'üíª', 'üåê', 'üìö', 'üí∞', 'üöÄ', 'üî•', '‚ö°', 'üß∞', 'üéØ', 'üì¶', 'üóÇÔ∏è', '‚úÖ', 'üîî', 'üí°', 'üéì', 'üë•', 'üìû', 'üè†'];
    const STORE_KEY = 'app-toolbox-v3';
    
    // Map filenames to friendly names and icons
    const FILE_MAPPINGS = {
      'index.html': { name: '–ü–æ—á–µ—Ç–Ω–∞', icon: 'üè†', category: '–°–∏—Å—Ç–µ–º', skip: true },
      'iiindex.html': { name: '–°—Ç–∞—Ä Index', icon: 'üìÑ', category: '–°–∏—Å—Ç–µ–º', skip: true },
      'StudentRecords.html': { name: '–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏ –î–æ—Å–∏–µ–∞', icon: 'üìã', category: '–£—á–µ–Ω–∏—Ü–∏' },
      'S_M_U_R_O_P.html': { name: '–°–ú–£–†–û–ü –î–Ω–µ–≤–Ω–∏–∫', icon: 'üìÖ', category: '–†–∞—Å–ø–æ—Ä–µ–¥' },
      'audiogram.html': { name: '–ê—É–¥–∏–æ–≥—Ä–∞–º', icon: 'üëÇ', category: '–¢–µ—Å—Ç–æ–≤–∏' },
      'kanban.html': { name: '–ö–∞–Ω–±–∞–Ω –¢–∞–±–ª–∞', icon: 'üìå', category: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—ò–∞' },
      'Kanban-Bookmark - Enhanced-v2.html': { name: '–ö–∞–Ω–±–∞–Ω –û–±–µ–ª–µ–∂—É–≤–∞—á–∏', icon: 'üîñ', category: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—ò–∞' },
      'cyrillic-whiteboard-enhanced.html': { name: '–ö–∏—Ä–∏–ª–∏—á–Ω–∞ –¢–∞–±–ª–∞', icon: '‚úèÔ∏è', category: '–ê–ª–∞—Ç–∫–∏' },
      'TabelaSoDokazi.html': { name: '–¢–∞–±–µ–ª–∞ —Å–æ –î–æ–∫–∞–∑–∏', icon: 'üìë', category: '–î–æ–∫—É–º–µ–Ω—Ç–∏' },
      '–ö–∞—Ä—Ç–∏—á–∫–∞.html': { name: '–ê–ê–ö –ö–∞—Ä—Ç–∏—á–∫–∏', icon: 'üé¥', category: 'AAC' }
    };

    /* ===== TRANSLATIONS ===== */
    const i18n = {
      mk: {
        title: 'App Toolbox',
        subtitle: '–ï–ª–µ–∫—Ç—Ä–æ–Ω—Å–∫–∏ —Å–∏—Å—Ç–µ–º –∑–∞ —Ä–µ—Å—É—Ä—Å–∏',
        searchPlaceholder: '–ü—Ä–µ–±–∞—Ä–∞—ò –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞...',
        filterAll: '–°–∏—Ç–µ',
        filterFavorites: '‚≠ê –û–º–∏–ª–µ–Ω–∏',
        filterRecent: 'üïê –ü–æ—Å–ª–µ–¥–Ω–∏',
        filterGithub: 'üîó GitHub',
        filterManual: '‚úèÔ∏è –†–∞—á–Ω–∏',
        scanRepo: '–°–∫–µ–Ω–∏—Ä–∞—ò',
        scanning: '–°–∫–µ–Ω–∏—Ä–∞—ö–µ...',
        scanSuccess: '–ù–∞—ò–¥–µ–Ω–∏ {count} HTML –¥–∞—Ç–æ—Ç–µ–∫–∏',
        scanError: '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–∫–µ–Ω–∏—Ä–∞—ö–µ',
        addApp: '–î–æ–¥–∞—ò –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞',
        editApp: '–£—Ä–µ–¥–∏ –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞',
        labelName: '–ò–º–µ',
        labelUrl: 'URL –õ–∏–Ω–∫',
        labelCategory: '–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞',
        labelPriority: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç',
        labelIcon: '–ò–∫–æ–Ω–∞',
        btnSave: '–ó–∞—á—É–≤–∞—ò',
        btnCancel: '–û—Ç–∫–∞–∂–∏',
        btnImport: '–ü–æ—á–Ω–∏ —É–≤–æ–∑',
        importTitle: '–£–≤–µ–∑–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏',
        addNew: '‚ûï –î–æ–¥–∞—ò –Ω–æ–≤ —Ä–µ—Å—É—Ä—Å',
        noApps: '–ù–µ–º–∞ –Ω–∞—ò–¥–µ–Ω–æ –∞–ø–ª–∏–∫–∞—Ü–∏–∏',
        confirmDelete: '–ò–∑–±—Ä–∏—à–∏?',
        exportSuccess: 'üì§ –£—Å–ø–µ—à–Ω–æ –∏–∑–≤–µ–∑–µ–Ω–æ!',
        importSuccess: '‚úÖ –£—Å–ø–µ—à–Ω–æ —É–≤–µ–∑–µ–Ω–æ!',
        importError: '‚ùå –ì—Ä–µ—à–µ–Ω —Ñ–æ—Ä–º–∞—Ç!',
        fillAll: '–ü–æ–ø–æ–ª–Ω–∏ —Å–∏—Ç–µ –ø–æ–ª–∏—ö–∞!',
        other: '–û—Å—Ç–∞–Ω–∞—Ç–æ',
        cleanExitTitle: '–ß–∏—Å—Ç –∏–∑–ª–µ–∑',
        cleanExitWarning: '–û–≤–∞ —ú–µ –≥–∏ –∏–∑–±—Ä–∏—à–µ –∏–∑–±—Ä–∞–Ω–∏—Ç–µ –ø–æ–¥–∞—Ç–æ—Ü–∏ –æ–¥ –æ–≤–æ—ò —É—Ä–µ–¥. –û–≤–∞–∞ –∞–∫—Ü–∏—ò–∞ –µ –Ω–µ–ø–æ–≤—Ä–∞—Ç–Ω–∞!',
        totalStorage: '–í–∫—É–ø–Ω–æ localStorage:',
        selectAll: '–ò–∑–±–µ—Ä–∏ —Å–∏—Ç–µ',
        btnCleanExit: '–ò–∑–±—Ä–∏—à–∏ –∏–∑–±—Ä–∞–Ω–æ –∏ –∏–∑–ª–µ–∑–∏',
        cleanExitSuccess: 'üßπ –ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ –∏–∑–±—Ä–∏—à–∞–Ω–∏!',
        cleanExitNone: '–ù–µ–º–∞ –∏–∑–±—Ä–∞–Ω–æ –Ω–∏—à—Ç–æ',
        goodbye: '–î–æ–≤–∏–¥—É–≤–∞—ö–µ! üëã'
      },
      en: {
        title: 'App Toolbox',
        subtitle: 'Electronic Resource System',
        searchPlaceholder: 'Search applications...',
        filterAll: 'All',
        filterFavorites: '‚≠ê Favorites',
        filterRecent: 'üïê Recent',
        filterGithub: 'üîó GitHub',
        filterManual: '‚úèÔ∏è Manual',
        scanRepo: 'Scan',
        scanning: 'Scanning...',
        scanSuccess: 'Found {count} HTML files',
        scanError: 'Scan error',
        addApp: 'Add Application',
        editApp: 'Edit Application',
        labelName: 'Name',
        labelUrl: 'URL Link',
        labelCategory: 'Category',
        labelPriority: 'Priority',
        labelIcon: 'Icon',
        btnSave: 'Save',
        btnCancel: 'Cancel',
        btnImport: 'Start Import',
        importTitle: 'Import Data',
        addNew: '‚ûï Add new resource',
        noApps: 'No applications found',
        confirmDelete: 'Delete?',
        exportSuccess: 'üì§ Exported successfully!',
        importSuccess: '‚úÖ Imported successfully!',
        importError: '‚ùå Invalid format!',
        fillAll: 'Fill all fields!',
        other: 'Other',
        cleanExitTitle: 'Clean Exit',
        cleanExitWarning: 'This will delete selected data from this device. This action is irreversible!',
        totalStorage: 'Total localStorage:',
        selectAll: 'Select all',
        btnCleanExit: 'Delete selected and exit',
        cleanExitSuccess: 'üßπ Data deleted!',
        cleanExitNone: 'Nothing selected',
        goodbye: 'Goodbye! üëã'
      }
    };

    /* ===== STATE ===== */
    let state = JSON.parse(localStorage.getItem(STORE_KEY)) || { 
      apps: [], 
      githubApps: [],
      theme: 'light', 
      lang: 'mk',
      recentlyUsed: [],
      repoUrl: ''
    };
    let editingId = null;
    let selectedIcon = 'üìã';
    let currentFilter = 'all';
    let selectedFile = null;

    /* ===== HELPERS ===== */
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const rid = () => Date.now().toString(36) + Math.random().toString(36).slice(2);
    const t = key => i18n[state.lang]?.[key] || i18n.mk[key] || key;

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    /* ===== CORE FUNCTIONS ===== */
    function save() { 
      localStorage.setItem(STORE_KEY, JSON.stringify(state)); 
      render(); 
    }

    function applyTranslations() {
      $$('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (i18n[state.lang]?.[key]) {
          el.innerHTML = i18n[state.lang][key];
        }
      });
      $$('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        if (i18n[state.lang]?.[key]) {
          el.placeholder = i18n[state.lang][key];
        }
      });
      $('#langBtn').textContent = state.lang === 'mk' ? 'EN' : 'MK';
      $('#themeBtn').textContent = state.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    function getAllApps() {
      // Combine manual apps and github apps
      const manual = state.apps.map(a => ({ ...a, source: 'manual' }));
      const github = state.githubApps.map(a => ({ ...a, source: 'github' }));
      return [...manual, ...github];
    }

    function render() {
      const main = $('#main');
      const search = $('#searchInput').value.toLowerCase().trim();
      
      let allApps = getAllApps();
      
      let apps = allApps.filter(a => {
        const matches = a.name.toLowerCase().includes(search) || 
                       (a.category || '').toLowerCase().includes(search) ||
                       (a.url || '').toLowerCase().includes(search);
        
        if (currentFilter === 'favorites') return matches && a.favorite;
        if (currentFilter === 'recent') return matches && state.recentlyUsed.includes(a.id);
        if (currentFilter === 'github') return matches && a.source === 'github';
        if (currentFilter === 'manual') return matches && a.source === 'manual';
        return matches;
      });

      // Group by category
      const groups = apps.reduce((acc, a) => {
        const c = a.category || t('other');
        if (!acc[c]) acc[c] = [];
        acc[c].push(a);
        return acc;
      }, {});

      let html = '';
      
      if (Object.keys(groups).length === 0) {
        html = `
          <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <div class="empty-state-text">${t('noApps')}</div>
          </div>
        `;
      } else {
        Object.keys(groups).sort().forEach(cat => {
          html += `
            <div class="category-section">
              <div class="category-header">
                <span class="category-title">${cat}</span>
                <span class="category-count">${groups[cat].length}</span>
              </div>
              <div class="app-grid">
          `;
          
          groups[cat].forEach(app => {
            html += `
              <a class="app-card" href="${app.url}" target="_blank" data-priority="${app.priority || 0}" data-source="${app.source}" onclick="trackUsage('${app.id}')">
                <button class="star-btn ${app.favorite ? 'active' : ''}" onclick="event.preventDefault(); event.stopPropagation(); toggleFav('${app.id}', '${app.source}')">‚òÖ</button>
                <div class="app-icon">${app.icon || 'üìã'}</div>
                <div class="app-info">
                  <div class="app-name">${app.name}</div>
                </div>
                <div class="card-actions">
                  <button class="action-btn" onclick="event.preventDefault(); event.stopPropagation(); editApp('${app.id}', '${app.source}')" title="–£—Ä–µ–¥–∏">‚úèÔ∏è</button>
                  ${app.source !== 'github' ? `<button class="action-btn delete" onclick="event.preventDefault(); event.stopPropagation(); delApp('${app.id}')" title="–ò–∑–±—Ä–∏—à–∏">üóëÔ∏è</button>` : ''}
                </div>
              </a>
            `;
          });
          
          html += `</div></div>`;
        });
      }
      
      // Add card
      html += `
        <div class="app-grid" style="margin-top: 24px">
          <div class="add-card" onclick="openAppModal()">
            ${t('addNew')}
          </div>
        </div>
      `;
      
      main.innerHTML = html;
      
      // Update stats
      $('#totalApps').textContent = allApps.length;
      $('#totalFavs').textContent = allApps.filter(a => a.favorite).length;
      $('#totalGithub').textContent = state.githubApps.length;
      
      // Update categories datalist
      const cats = [...new Set(allApps.map(a => a.category).filter(Boolean))];
      $('#categories').innerHTML = cats.map(c => `<option value="${c}">`).join('');
      
      renderBottom();
      applyTranslations();
    }

    function renderBottom() {
      const allApps = getAllApps();
      const favs = allApps.filter(a => a.favorite).slice(0, 10);
      $('#bottomBar').style.display = favs.length ? 'block' : 'none';
      $('#bottomGrid').innerHTML = favs.map(a => 
        `<a href="${a.url}" target="_blank" class="bottom-card" onclick="trackUsage('${a.id}')">${a.icon || 'üìã'} ${a.name}</a>`
      ).join('');
    }

    function renderIconPicker() {
      $('#iconPicker').innerHTML = ICONS.map(icon => 
        `<div class="icon-option ${selectedIcon === icon ? 'active' : ''}" onclick="selectIcon('${icon}')">${icon}</div>`
      ).join('');
    }

    /* ===== GITHUB SCANNING ===== */
    window.scanGitHub = async () => {
      // Prompt for repo name (secure - not stored in visible input)
      const savedRepo = state.repoUrl || 'Assisstant/MTB';
      const repoUrl = prompt(
        state.lang === 'mk' 
          ? 'üìÇ –í–Ω–µ—Å–∏ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—É–º (username/repo):' 
          : 'üìÇ Enter GitHub repository (username/repo):',
        savedRepo
      );
      
      if (!repoUrl || !repoUrl.trim()) return;
      
      // Save repo URL
      state.repoUrl = repoUrl.trim();
      
      showToast(state.lang === 'mk' ? 'üîÑ –°–∫–µ–Ω–∏—Ä–∞—ö–µ...' : 'üîÑ Scanning...', 'success');
      
      try {
        // GitHub API to get repo contents
        const apiUrl = `https://api.github.com/repos/${repoUrl}/contents`;
        const response = await fetch(apiUrl);
        
        if (!response.ok) throw new Error('Repo not found');
        
        const files = await response.json();
        
        // Filter HTML files, skip those marked with skip:true in mappings
        const htmlFiles = files.filter(f => {
          if (!f.name.endsWith('.html') || f.type !== 'file') return false;
          const mapping = FILE_MAPPINGS[f.name];
          if (mapping && mapping.skip) return false;
          return true;
        });
        
        // Convert to app objects
        const baseUrl = `https://${repoUrl.split('/')[0]}.github.io/${repoUrl.split('/')[1]}/`;
        
        state.githubApps = htmlFiles.map(file => {
          const mapping = FILE_MAPPINGS[file.name] || {};
          const cleanName = file.name.replace('.html', '').replace(/-/g, ' ').replace(/_/g, ' ');
          
          return {
            id: 'gh_' + file.sha.slice(0, 8),
            name: mapping.name || cleanName,
            url: file.name, // Relative URL works if hosted on same domain
            fullUrl: baseUrl + file.name,
            icon: mapping.icon || 'üìÑ',
            category: mapping.category || 'GitHub Apps',
            priority: '0',
            favorite: false,
            fileName: file.name,
            size: file.size
          };
        });
        
        // Preserve favorites from previous scan
        const oldFavs = new Set(
          (JSON.parse(localStorage.getItem(STORE_KEY))?.githubApps || [])
            .filter(a => a.favorite)
            .map(a => a.fileName)
        );
        
        state.githubApps.forEach(app => {
          if (oldFavs.has(app.fileName)) app.favorite = true;
        });
        
        save();
        
        const msg = state.lang === 'mk' 
          ? `‚úÖ –ù–∞—ò–¥–µ–Ω–∏ ${htmlFiles.length} –∞–ø–ª–∏–∫–∞—Ü–∏–∏` 
          : `‚úÖ Found ${htmlFiles.length} applications`;
        showToast(msg, 'success');
        
      } catch (err) {
        console.error(err);
        const msg = state.lang === 'mk' 
          ? '‚ùå –ì—Ä–µ—à–∫–∞: ' + err.message 
          : '‚ùå Error: ' + err.message;
        showToast(msg, 'error');
      }
    };

    /* ===== APP ACTIONS ===== */
    window.toggleFav = (id, source) => { 
      if (source === 'github') {
        const app = state.githubApps.find(x => x.id === id);
        if (app) app.favorite = !app.favorite;
      } else {
        const app = state.apps.find(x => x.id === id);
        if (app) app.favorite = !app.favorite;
      }
      save(); 
    };

    window.trackUsage = id => { 
      state.recentlyUsed = [id, ...state.recentlyUsed.filter(x => x !== id)].slice(0, 20); 
      save(); 
    };

    window.delApp = id => { 
      if (confirm(t('confirmDelete'))) { 
        state.apps = state.apps.filter(x => x.id !== id); 
        save(); 
      }
    };

    window.editApp = (id, source) => { 
      if (source === 'github') {
        const app = state.githubApps.find(x => x.id === id);
        editingId = { id, source: 'github' };
        openAppModal(app);
      } else {
        const app = state.apps.find(x => x.id === id);
        editingId = { id, source: 'manual' };
        openAppModal(app);
      }
    };

    window.selectIcon = icon => {
      selectedIcon = icon;
      renderIconPicker();
    };

    /* ===== MODAL FUNCTIONS ===== */
    window.openAppModal = (app = null) => {
      $('#appModal').classList.add('show');
      $('#modalTitle').innerHTML = app ? `‚úèÔ∏è <span>${t('editApp')}</span>` : `‚ûï <span>${t('addApp')}</span>`;
      $('#appName').value = app ? app.name : '';
      $('#appUrl').value = app ? app.url : '';
      $('#appCategory').value = app ? (app.category || '') : '';
      $('#appPriority').value = app ? (app.priority || 0) : 0;
      selectedIcon = app ? (app.icon || 'üìã') : 'üìã';
      renderIconPicker();
      applyTranslations();
    };

    window.closeAppModal = () => {
      $('#appModal').classList.remove('show');
      editingId = null;
    };

    window.saveApp = () => {
      const name = $('#appName').value.trim();
      const url = $('#appUrl').value.trim();
      
      if (!name || !url) {
        showToast(t('fillAll'), 'error');
        return;
      }
      
      if (editingId) {
        if (editingId.source === 'github') {
          const app = state.githubApps.find(x => x.id === editingId.id);
          Object.assign(app, { 
            name, 
            category: $('#appCategory').value.trim(), 
            priority: $('#appPriority').value, 
            icon: selectedIcon 
          });
        } else {
          const app = state.apps.find(x => x.id === editingId.id);
          Object.assign(app, { 
            name, 
            url, 
            category: $('#appCategory').value.trim(), 
            priority: $('#appPriority').value, 
            icon: selectedIcon 
          });
        }
        editingId = null;
      } else {
        state.apps.push({ 
          id: rid(), 
          name, 
          url, 
          category: $('#appCategory').value.trim(), 
          priority: $('#appPriority').value, 
          icon: selectedIcon, 
          favorite: false 
        });
      }
      
      save(); 
      closeAppModal();
    };

    /* ===== CLEAN EXIT ===== */
    window.openCleanExitModal = () => {
      $('#cleanExitModal').classList.add('show');
      renderStorageList();
    };

    window.closeCleanExitModal = () => {
      $('#cleanExitModal').classList.remove('show');
    };

    function renderStorageList() {
      const listEl = $('#storageList');
      let totalSize = 0;
      let html = '';
      
      // Get all localStorage keys
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        const size = new Blob([value]).size;
        totalSize += size;
        
        // Try to identify the app
        let appName = key;
        let appIcon = 'üì¶';
        
        if (key.includes('toolbox')) { appName = 'App Toolbox'; appIcon = 'üß∞'; }
        else if (key.includes('student') || key.includes('Student')) { appName = '–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏ –î–æ—Å–∏–µ–∞'; appIcon = 'üìã'; }
        else if (key.includes('smurop') || key.includes('diary')) { appName = '–°–ú–£–†–û–ü –î–Ω–µ–≤–Ω–∏–∫'; appIcon = 'üìÖ'; }
        else if (key.includes('audiogram')) { appName = '–ê—É–¥–∏–æ–≥—Ä–∞–º'; appIcon = 'üëÇ'; }
        else if (key.includes('kanban')) { appName = '–ö–∞–Ω–±–∞–Ω'; appIcon = 'üìå'; }
        else if (key.includes('whiteboard')) { appName = '–¢–∞–±–ª–∞'; appIcon = '‚úèÔ∏è'; }
        
        html += `
          <div class="storage-item">
            <input type="checkbox" class="storage-checkbox" data-key="${key}" id="chk_${i}">
            <div class="storage-info">
              <div class="storage-key">${appIcon} ${appName}</div>
              <div class="storage-size">${key} ‚Ä¢ ${formatBytes(size)}</div>
            </div>
          </div>
        `;
      }
      
      listEl.innerHTML = html || '<p style="text-align:center; color: var(--text-secondary)">localStorage –µ –ø—Ä–∞–∑–µ–Ω</p>';
      $('#totalStorageSize').textContent = formatBytes(totalSize);
      $('#selectAllCheckbox').checked = false;
    }

    window.toggleSelectAll = () => {
      const selectAll = $('#selectAllCheckbox');
      selectAll.checked = !selectAll.checked;
      $$('.storage-checkbox[data-key]').forEach(cb => {
        cb.checked = selectAll.checked;
      });
    };

    window.performCleanExit = () => {
      const checkboxes = $$('.storage-checkbox[data-key]:checked');
      
      if (checkboxes.length === 0) {
        showToast(t('cleanExitNone'), 'error');
        return;
      }
      
      // Delete selected keys
      checkboxes.forEach(cb => {
        const key = cb.dataset.key;
        localStorage.removeItem(key);
      });
      
      showToast(t('cleanExitSuccess'), 'success');
      
      // Close modal and show goodbye
      closeCleanExitModal();
      
      setTimeout(() => {
        document.body.innerHTML = `
          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background: var(--bg); color: var(--text); text-align: center; padding: 20px;">
            <div style="font-size: 80px; margin-bottom: 20px;">üëã</div>
            <h1 style="font-size: 32px; margin-bottom: 10px;">${t('goodbye')}</h1>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">
              ${state.lang === 'mk' ? '–ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ –∏–∑–±—Ä–∏—à–∞–Ω–∏ –æ–¥ –æ–≤–æ—ò —É—Ä–µ–¥.' : 'Data has been deleted from this device.'}
            </p>
            <p style="font-size: 14px; color: var(--text-secondary);">
              ${state.lang === 'mk' ? '–ú–æ–∂–µ—Ç–µ –±–µ–∑–±–µ–¥–Ω–æ –¥–∞ –≥–æ –∑–∞—Ç–≤–æ—Ä–∏—Ç–µ –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç.' : 'You can safely close this window.'}
            </p>
          </div>
        `;
      }, 1000);
    };

    /* ===== IMPORT/EXPORT ===== */
    window.openImportModal = () => {
      $('#importModal').classList.add('show');
      $('#importData').value = '';
      $('#fileInfo').innerHTML = '';
      selectedFile = null;
    };

    window.closeImportModal = () => {
      $('#importModal').classList.remove('show');
      selectedFile = null;
    };

    window.handleFileSelect = (event) => {
      const file = event.target.files[0];
      if (file) {
        selectedFile = file;
        $('#fileInfo').innerHTML = `
          <div class="file-selected">
            üìÑ ${file.name} (${formatBytes(file.size)})
          </div>
        `;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          $('#importData').value = e.target.result;
        };
        reader.readAsText(file);
      }
    };

    // Drag and drop
    const fileDrop = document.getElementById('fileDrop');
    fileDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDrop.classList.add('dragover');
    });
    fileDrop.addEventListener('dragleave', () => {
      fileDrop.classList.remove('dragover');
    });
    fileDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDrop.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) {
        handleFileSelect({ target: { files: [file] } });
      }
    });

    window.doImport = () => {
      try {
        const data = JSON.parse($('#importData').value);
        
        if (data.apps && Array.isArray(data.apps)) state.apps = data.apps;
        if (data.githubApps && Array.isArray(data.githubApps)) state.githubApps = data.githubApps;
        if (data.theme) {
          state.theme = data.theme;
          document.documentElement.dataset.theme = state.theme;
        }
        if (data.lang) state.lang = data.lang;
        if (data.recentlyUsed && Array.isArray(data.recentlyUsed)) state.recentlyUsed = data.recentlyUsed;
        if (data.repoUrl) state.repoUrl = data.repoUrl;
        
        save();
        closeImportModal();
        showToast(t('importSuccess'), 'success');
      } catch (e) {
        showToast(t('importError') + ' ' + e.message, 'error');
      }
    };

    window.exportData = () => {
      const exportState = {
        apps: state.apps,
        githubApps: state.githubApps,
        theme: state.theme,
        lang: state.lang,
        recentlyUsed: state.recentlyUsed,
        repoUrl: state.repoUrl,
        exportDate: new Date().toISOString(),
        version: '3.0'
      };
      
      const blob = new Blob([JSON.stringify(exportState, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `toolbox-backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      
      showToast(t('exportSuccess'), 'success');
    };

    /* ===== THEME & LANGUAGE ===== */
    window.toggleLang = () => {
      state.lang = state.lang === 'mk' ? 'en' : 'mk';
      save();
    };

    $('#themeBtn').onclick = () => {
      state.theme = state.theme === 'dark' ? 'light' : 'dark';
      document.documentElement.dataset.theme = state.theme;
      save();
    };

    /* ===== FILTERS ===== */
    $$('.filter-tab').forEach(btn => {
      btn.onclick = () => {
        $$('.filter-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        render();
      };
    });

    window.resetView = () => { 
      $('#searchInput').value = ''; 
      currentFilter = 'all';
      $$('.filter-tab').forEach(b => b.classList.remove('active'));
      $('.filter-tab[data-filter="all"]').classList.add('active');
      render(); 
    };

    /* ===== TOAST ===== */
    function showToast(message, type = 'success') {
      const toast = $('#toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    /* ===== SEARCH ===== */
    $('#searchInput').oninput = render;

    /* ===== INIT ===== */
    document.documentElement.dataset.theme = state.theme;
    render();
  </script>
</body>
</html>
